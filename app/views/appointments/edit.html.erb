<div class="container-xxl py-4">
  <div class="row g-4">
    <div class="col-lg-7">
      <div class="card appt-card">
        <div class="card-body p-4">
          <h2 class="h4 mb-1" style="color:var(--primary)">Agendar Cita M√©dica</h2>
          <p class="text-muted mb-4">Selecciona la fecha, hora y especialidad para tu consulta</p>

          <%= form_with model: @appointment, url: appointments_path, class: "row g-3", local: true do |f| %>
            <div class="col-12">
              <%= f.label :specialty, "Especialidad *", class: "form-label fw-semibold" %>
              <%= f.select :specialty,
                    options_for_select(Appointment::SPECIALTIES, @appointment.specialty),
                    { include_blank: "Selecciona una especialidad" },
                    class: "form-select form-select-lg appt-select" %>
            </div>

            <div class="col-md-6">
              <%= label_tag :appointment_date, "Fecha *", class: "form-label fw-semibold" %>
              <div class="input-group">
                <span class="input-group-text">üìÖ</span>
                <%= date_field_tag :appointment_date, (@appointment.scheduled_at&.to_date),
                      class: "form-control form-control-lg", required: true %>
              </div>
            </div>

            <div class="col-md-6">
              <%= label_tag :appointment_time, "Hora *", class: "form-label fw-semibold" %>
              <div class="input-group">
                <span class="input-group-text">‚è∞</span>
                <%= time_field_tag :appointment_time, (@appointment.scheduled_at&.strftime("%H:%M")),
                      class: "form-control form-control-lg", step: 900, required: true %>
              </div>
            </div>

            <div class="col-12">
              <%= f.label :reason, "Motivo de consulta *", class: "form-label fw-semibold" %>
              <%= f.text_field :reason,
                    class: "form-control form-control-lg appt-input",
                    placeholder: "Ej: Dolor abdominal, control, etc.",
                    required: true %>
            </div>

            <div class="col-12">
              <%= f.label :notes, "Notas adicionales (opcional)", class: "form-label fw-semibold" %>
              <%= f.text_area :notes, rows: 4,
                    class: "form-control appt-area",
                    placeholder: "Describe tus s√≠ntomas o motivo de consulta..." %>
            </div>

            <div class="col-12">
              <%= f.submit "Agendar cita", class: "btn btn-primary btn-lg w-100" %>
            </div>

            <%= hidden_field_tag "appointment[date]", nil, id: "hidden_date" %>
            <%= hidden_field_tag "appointment[time]", nil, id: "hidden_time" %>
          <% end %>
        </div>
      </div>
    </div>

    <div class="col-lg-5">
      <div class="card appt-side">
        <div class="card-body p-4">
          <h3 class="h5 mb-1">Mis Citas</h3>
          <p class="text-muted mb-3">Historial de citas m√©dicas</p>

          <% if @appointments.present? %>
            <ul class="list-group list-group-flush">
              <% @appointments.each do |a| %>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    <div class="fw-semibold"><%= a.reason %> ‚Äî <span class="text-muted"><%= a.specialty %></span></div>
                    <div class="small text-muted"><%= l a.scheduled_at, format: :long %></div>
                  </div>
                  <div class="d-flex gap-2">
                    <%= link_to "Editar", edit_appointment_path(a), class: "btn btn-outline-primary btn-sm" %>
                    <%= link_to "Eliminar", a,
                          data: { turbo_method: :delete, turbo_confirm: "¬øEliminar esta cita?" },
                          class: "btn btn-outline-danger btn-sm" %>
                  </div>
                </li>
              <% end %>
            </ul>
          <% else %>
            <div class="text-center text-muted py-4">No tienes citas agendadas</div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("turbo:load", () => {
    const form = document.querySelector("form");
    if (!form) return;

    form.addEventListener("submit", () => {
      const d = document.querySelector("#appointment_date");
      const t = document.querySelector("#appointment_time");
      document.querySelector("#hidden_date").value = d ? d.value : "";
      document.querySelector("#hidden_time").value = t ? t.value : "";
    });
  });
</script>
